<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Look for a sheter near you.">
  <meta name="author" content="alpha.ca.gov team">
  <title>Find a Shelter - Alpha.CA.gov</title>

  <!-- Bootstrap core CSS -->
  <link href="https://cwds.dev/docs/4.3/dist/css/bootstrap.css" rel="stylesheet">
  <link href="https://cwds.dev/docs/4.3/assets/css/docs.css" rel="stylesheet" />
  

  <!-- Favicons -->
  <link rel="apple-touch-icon" href="https://cwds.dev/docs/4.3/assets/img/favicons/apple-touch-icon.png"
    sizes="180x180">
  <link rel="icon" href="https://cwds.dev/docs/4.3/assets/img/favicons/favicon-32x32.png" sizes="32x32"
    type="image/png">
  <link rel="icon" href="https://cwds.dev/docs/4.3/assets/img/favicons/favicon-16x16.png" sizes="16x16"
    type="image/png">

  <link rel="mask-icon" href="https://cwds.dev/docs/4.3/assets/img/favicons/safari-pinned-tab.svg" color="#1d1a16">
  <link rel="icon" href="https://cwds.dev/docs/4.3/assets/img/favicons/favicon.ico">
  <meta name="msapplication-config" content="https://cwds.dev/docs/4.3/assets/img/favicons/browserconfig.xml">
  <meta name="theme-color" content="#000000">
  <link href="https://california.azureedge.net/cdt/statetemplate/6.0.0/css/cagov.font-only.min.css" rel="stylesheet" />
</head>
	
<style>
.d-none {
	display: none;
}
</style>

<body>
  <link href="https://california.azureedge.net/cdt/statetemplate/6.0.0/css/cagov.font-only.min.css" rel="stylesheet" />
  <div class="official">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <p>State of California</p>
        </div>
      </div>
    </div>
  </div>

  <nav class="navbar navbar-inverse">
    <div class="container">
      <div class="navbar-header">
        <a class="navbar-brand navbar-left" href="/UX/">CA.gov <sup>(ALPHA)</sup></a>
      </div>
    </div>
  </nav>

  <div class="container-fluid jumbotron">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <h1>Find a shelter near you</h1>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="row">
      <div class="col-lg-9">
       <p class="lead">select a city to find a shelter</p>
       <form method="GET">
        <select name="city" required>
          <option value=""></option>
        </select>
        <p>
          <input type="submit" value="Go">
          <a href=".">Start Over</a>
        </p>
        
        </form>
      </div> 
    </div> 
  </div> 

  <div class="container d-none">
    <div class="row">
      <div class="col-lg-9">
        <p class="lead">Shelters in <span id="selected-city"></span></p>
        <div id="results"></div>
      </div> 
    </div> 
  </div> 


<script src="citylist.js"></script>
<script type="text/javascript">
	
(function() {

  const selectedcity = getParameterByName("city")

  const citylist = document.querySelector('select')



  citylistjson().forEach(x=>{
      var option = document.createElement("option");
      option.text = x.name
      option.value = x.code

      if(selectedcity===x.code) {
        document.getElementById("selected-city").innerText = x.name
        option.selected=true;
      }
       
      citylist.add(option)
    }
  )
  
if(selectedcity) {
  document.querySelector('.d-none').classList.toggle("d-none")

  const results = document.getElementById("results")

  // Result sample
  //{
  //  "name": "Community Action Of Napa Valley - Samaritan Family Shelter",
  //  "address": "2521 Old Sonoma Road",
  //  "city": "Napa",
  //  "state": "CA",
  //  "zipcode": "94558",
  //  "phone": "707-253-6145",
  //  "url": "https://www.shelterlistings.org/details/19263/",
  //  "description": "Family Shelter The Samaritan Family Center gives families without a home a place to  begin rebuilding their lives. There, those in need will find a room for  their family, as well as the help needed to plan their next steps to  self-sufficiency. Every week, the team works with residents on setting  and achieving goals, all with the aim of getting them back on their  feet... (continued)"
  //},

  fetch(`https://api.alpha.ca.gov/HomelessShelters/${selectedcity}`)
    .then(response => response.json())
    .then(data => {
      for (const row of data) {
        const addresscombo = `${row.address}, ${row.city}, ${row.state} ${row.zipcode}`

        const name = document.createElement("p")
        name.innerHTML = row.name
        results.appendChild(name)

        const phone = document.createElement("a")
        phone.href = `tel:${row.phone}`
        phone.innerHTML = "<br/>"+row.phone
        name.appendChild(phone)

        const externallink = document.createElement("a")
        externallink.href = row.url
        externallink.innerHTML = "<br/>(more)"
        name.appendChild(externallink)

        const link = document.createElement("a")
        link.href = `https://maps.google.com/?q=${addresscombo}`
        link.innerHTML = addresscombo
        results.appendChild(link)

        const description = document.createElement("p")
        description.innerHTML = row.description
        results.appendChild(description)

        const space = document.createElement("p")
        space.innerHTML = "&nbsp;"
        results.appendChild(space)
        
      }
  })
}



function getParameterByName(name) {
   name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
   var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
    results = regex.exec(location.search);
   return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
}

}())
</script>
</html>
